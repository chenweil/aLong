<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Kubernetes on aLong Blog</title><link>https://blog.51ai.vip/aLong/tags/kubernetes/</link><description>Recent content in Kubernetes on aLong Blog</description><generator>Hugo</generator><language>en</language><lastBuildDate>Wed, 11 Jan 2023 16:30:47 +0800</lastBuildDate><atom:link href="https://blog.51ai.vip/aLong/tags/kubernetes/index.xml" rel="self" type="application/rss+xml"/><item><title>Ubuntu22.04å®‰è£…kubeadm</title><link>https://blog.51ai.vip/aLong/posts/ubuntu22.04%E5%AE%89%E8%A3%85kubeadm/</link><pubDate>Wed, 11 Jan 2023 16:30:47 +0800</pubDate><guid>https://blog.51ai.vip/aLong/posts/ubuntu22.04%E5%AE%89%E8%A3%85kubeadm/</guid><description>&lt;h1 id="å­¦ä¹ k8s">å­¦ä¹ k8s&lt;/h1>
&lt;p>å­¦ä¹ k8såšç¬”è®°ï¼Œé€šè¿‡kubeadmæ­å»º1masterã€2nodeã€‚ç½‘ç»œæ’ä»¶ï¼šflannelã€‚ç³»ç»ŸUbuntu22.04&lt;/p>
&lt;h2 id="ç³»ç»Ÿå®‰è£…docker">ç³»ç»Ÿå®‰è£…docker&lt;/h2>
&lt;p>&lt;a href="https://docs.docker.com/engine/install/ubuntu/">Dockerå®˜æ–¹æ‰‹å†Œ&lt;/a>&lt;/p>
&lt;p>masterã€nodeè®¾å¤‡å„å®‰è£…dockerã€kubeletã€ kubeadmã€ kubectlã€‚&lt;/p>
&lt;h2 id="ä¸ºkubeadmå‡†å¤‡">ä¸ºkubeadmå‡†å¤‡&lt;/h2>
&lt;p>masterã€nodeè¿›è¡Œå‡†å¤‡å·¥ä½œï¼š&lt;/p>
&lt;ol>
&lt;li>å°†cgroupå¤„ç†æ”¹æˆsystemd&lt;/li>
&lt;/ol>
&lt;p>nano /etc/docker/daemon.json&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;exec-opts&amp;#34;&lt;/span>: [&lt;span style="color:#e6db74">&amp;#34;native.cgroupdriver=systemd&amp;#34;&lt;/span>],
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;log-driver&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;json-file&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;log-opts&amp;#34;&lt;/span>: {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;max-size&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;100m&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> },
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;storage-driver&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;overlay2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>sudo systemctl enable docker&lt;/code>
&lt;code>sudo systemctl daemon-reload&lt;/code>
&lt;code>sudo systemctl restart docker&lt;/code>&lt;/p>
&lt;ol start="2">
&lt;li>ä¸ºäº†è®© Kubernetes èƒ½å¤Ÿæ£€æŸ¥ã€è½¬å‘ç½‘ç»œæµé‡ï¼Œä½ éœ€è¦ä¿®æ”¹ iptables çš„é…ç½®ï¼Œå¯ç”¨â€œbr_netfilterâ€æ¨¡å—&lt;/li>
&lt;/ol>
&lt;p>&lt;code>nano /etc/modules-load.d/k8s.conf&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ini" data-lang="ini">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">br_netfilter&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>nano /etc/sysctl.d/k8s.conf&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ini" data-lang="ini">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">net.bridge.bridge-nf-call-ip6tables&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">net.bridge.bridge-nf-call-iptables&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">net.ipv4.ip_forward&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>sudo sysctl --system&lt;/code>&lt;/p>
&lt;ol start="3">
&lt;li>ä¿®æ”¹â€œ/etc/fstabâ€ï¼Œå…³é—­ Linux çš„ swap åˆ†åŒºï¼Œæå‡ Kubernetes çš„æ€§èƒ½&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ini" data-lang="ini">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">sudo swapoff -a&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">sudo sed -ri &amp;#39;/\sswap\s/s/^#?/#/&amp;#39; /etc/fstab&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å®‰è£…kubeadm">å®‰è£…kubeadm&lt;/h3>
&lt;p>&lt;a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/">Kuneadmå®˜æ–¹æ‰‹å†Œ&lt;/a>
&lt;strong>åœ¨masterã€nodeä¸Šéƒ½éœ€è¦å®‰è£…&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>æ›´æ–°Â &lt;code>apt&lt;/code>Â åŒ…ç´¢å¼•å¹¶å®‰è£…ä½¿ç”¨ KubernetesÂ &lt;code>apt&lt;/code>Â ä»“åº“æ‰€éœ€è¦çš„åŒ…ï¼š&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>sudo apt-get update
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo apt-get install -y apt-transport-https ca-certificates curl
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>(æœ‰æ¡ä»¶)ä¸‹è½½ Google Cloud å…¬å¼€ç­¾åç§˜é’¥ï¼š&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>sudo curl -fsSLo /etc/apt/keyrings/kubernetes-archive-keyring.gpg https://packages.cloud.google.com/apt/doc/apt-key.gpg
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æžœä¸Šé¢è®¿é—®ä¸åˆ°ï¼Œå¯é€‰æ‹©å…¶ä»–,ä¾‹å¦‚&lt;a href="https://mirrors.tuna.tsinghua.edu.cn/help/kubernetes/">æ¸…åŽæº&lt;/a>æä¾›ï¼š
å¯¼å…¥gpg key&lt;/p></description></item><item><title>é€šè¿‡minikubeéƒ¨ç½²K8Så­¦ä¹ çŽ¯å¢ƒ</title><link>https://blog.51ai.vip/aLong/posts/%E9%80%9A%E8%BF%87minikube%E9%83%A8%E7%BD%B2k8s%E5%AD%A6%E4%B9%A0%E7%8E%AF%E5%A2%83/</link><pubDate>Fri, 06 Jan 2023 15:35:43 +0800</pubDate><guid>https://blog.51ai.vip/aLong/posts/%E9%80%9A%E8%BF%87minikube%E9%83%A8%E7%BD%B2k8s%E5%AD%A6%E4%B9%A0%E7%8E%AF%E5%A2%83/</guid><description>&lt;p>Minikube æ˜¯æœ¬åœ° Kubernetesï¼Œä¸“æ³¨äºŽè®© Kubernetes æ˜“äºŽå­¦ä¹ å’Œå¼€å‘ã€‚&lt;/p>
&lt;h1 id="macoséƒ¨ç½²æ–¹å¼">MacOSéƒ¨ç½²æ–¹å¼:&lt;/h1>
&lt;p>&lt;a href="https://minikube.sigs.k8s.io/docs/start/">å®˜æ–¹æ•™ç¨‹&lt;/a>&lt;/p>
&lt;p>æœ¬æ¬¡ä½¿ç”¨çš„é©±åŠ¨æ˜¯ parallelsé©±åŠ¨ã€‚æ‰€ä»¥æœ¬æœºéœ€è¦å®‰è£…æ­¤è½¯ä»¶ã€‚
å®‰è£…kubectlï¼š&lt;code>brew install kubectl&lt;/code>
å®‰è£…minikubeï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-darwin-amd64
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo install minikube-darwin-amd64 /usr/local/bin/minikube
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="é€šè¿‡minikubeå¯åŠ¨é›†ç¾¤">é€šè¿‡minikubeå¯åŠ¨é›†ç¾¤&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>minikube start &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span>--kubernetes-version&lt;span style="color:#f92672">=&lt;/span>v1.23.9 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span>--image-mirror-country&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;cn&amp;#39;&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span>--registry-mirror&lt;span style="color:#f92672">=&lt;/span>https://ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ.mirror.aliyuncs.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å› ä¸ºæ˜¯å›½å†…ï¼Œæ‰€ä»¥&lt;code>--image-mirror-country='cn'&lt;/code>ã€‚é€šè¿‡&lt;code>--registry-mirror&lt;/code>ä¸º Docker daemon é…ç½®é•œåƒåŠ é€Ÿã€‚ä¾‹å¦‚ä¸Šé¢æ˜¯é˜¿é‡Œäº‘é•œåƒæœåŠ¡åœ°å€ã€‚
å› ä¸ºæˆ‘å­¦ä¹ çš„ç‰ˆæœ¬æ˜¯1.23.xï¼Œæ‰€ä»¥åˆ¶å®šäº†ç‰ˆæœ¬&lt;code>--kubernetes-version=v1.23.9&lt;/code>ã€‚
é»˜è®¤ä»–è¯»åŽ»äº†é©±åŠ¨é…ç½®ï¼Œè¯†åˆ«æ˜¯&lt;code>parallels&lt;/code>,è‡ªå·±å®šä¹‰æ–¹å¼&lt;code>--driver=hyperkit&lt;/code>ã€‚&lt;/p>
&lt;p>å®‰è£…ç»“æžœï¼š
&lt;img src="https://s2.loli.net/2023/01/06/C3AFxdiPbq8aIuR.jpg" alt="C3AFxdiPbq8aIuR">&lt;/p>
&lt;p>&lt;em>é”™è¯¯&lt;/em>ï¼š
å¦‚æžœå­˜åœ¨é”™è¯¯è¯·çœ‹å…·ä½“ä¸Šé¢çš„é—®é¢˜ï¼Œå¾ˆå¤šæƒ…å†µéƒ½èƒ½ç›´è§‚çœ‹åˆ°æç¤ºã€‚å…¶ä¸­å›¾æ ‡æ˜¯â—ï¸æç¤ºä¸€äº›é—®é¢˜ã€ðŸ’¡ç»™ä½ ä¸€äº›å»ºè®®ç­‰ç­‰ã€‚&lt;/p>
&lt;h4 id="é©±åŠ¨é€‰æ‹©">é©±åŠ¨é€‰æ‹©ï¼š&lt;/h4>
&lt;p>ä½¿ç”¨dockeré©±åŠ¨éœ€è¦å®‰è£…docker desktopã€‚å…¶ä»–é©±åŠ¨ï¼švirtualboxã€vmwareã€sshã€Hyperkitç­‰ã€‚å…·ä½“è¯¦è§&lt;a href="https://minikube.sigs.k8s.io/docs/drivers/">drivers page&lt;/a>&lt;/p>
&lt;h3 id="éªŒè¯ç»“æžœ">éªŒè¯ç»“æžœ&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>æŸ¥è¯¢minikubeçŠ¶æ€
&lt;img src="https://s2.loli.net/2023/01/06/otU8LYBjuFeDa31.png" alt="otU8LYBjuFeDa31">&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è¿›å…¥é¢æ¿
&lt;img src="https://s2.loli.net/2023/01/06/FmrBXOTJ1N2AZgU.png" alt="FmrBXOTJ1N2AZgU">
&lt;img src="https://s2.loli.net/2023/01/06/IPBCwUSx7Fb28Ee.png" alt="IPBCwUSx7Fb28Ee">&lt;/p>
&lt;/li>
&lt;li>
&lt;p>kubectlæŽ§åˆ¶
&lt;code>minikube kubectl -- get pods -A&lt;/code>
&lt;img src="https://s2.loli.net/2023/01/06/EziUHcpln27ufeB.png" alt="EziUHcpln27ufeB">&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>kubectlåœ¨minikubeä¸­ä½¿ç”¨ï¼Œéœ€è¦å†™ &lt;code>nimikune kubectl --&lt;/code>åŽé¢åŠ å…¥æ‰§è¡Œçš„å‘½ä»¤ã€‚
macosé»˜è®¤ä½¿ç”¨çš„zshï¼Œåœ¨zshåŠ å…¥aliaså°±å¯ä»¥æ•²çš„å°‘çš„äº†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-zsh" data-lang="zsh">&lt;span style="display:flex;">&lt;span>vi ~/.zshrc
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#åŠ å…¥ä¸€è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>alias kubectl&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;minikube kubectl --&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#é€€å‡º&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>source ~/.zshrc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>å†åˆ›å»ºä¸€ä¸ªPod
åˆ›å»ºï¼š
&lt;code>kubectl run nginx --image=nginx:alpine&lt;/code>
æŸ¥è¯¢ï¼š
&lt;code>kubectl get pods nginx&lt;/code>
è¯¦æƒ…ï¼š
&lt;code>kubectl describe pods nginx&lt;/code>
&lt;img src="https://s2.loli.net/2023/01/06/pYPqIgt84LzBcEU.png" alt="pYPqIgt84LzBcEU">&lt;/li>
&lt;/ul>
&lt;p>åˆ°è¿™é‡Œk8så¯ä»¥ä½¿ç”¨äº†ã€‚&lt;/p></description></item></channel></rss>