<!DOCTYPE html>
<html lang="en" dir=" auto">

<head><script src="/aLong/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=aLong/livereload" data-no-instant defer></script>
</head>

<body class="" id="
    top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/aLong/" accesskey="h" title="aLong blog (Alt + H)">aLong blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      通过minikube部署K8S学习环境
    </h1>
    <div class="post-meta"><span title='2023-01-06 15:35:43 +0800 CST'>2023-01-06</span>

</div>
  </header> 
  <div class="post-content"><p>Minikube 是本地 Kubernetes，专注于让 Kubernetes 易于学习和开发。</p>
<h1 id="macos部署方式">MacOS部署方式:<a hidden class="anchor" aria-hidden="true" href="#macos部署方式">#</a></h1>
<p><a href="https://minikube.sigs.k8s.io/docs/start/">官方教程</a></p>
<p>本次使用的驱动是 parallels驱动。所以本机需要安装此软件。
安装kubectl：<code>brew install kubectl</code>
安装minikube：</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-darwin-amd64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sudo install minikube-darwin-amd64 /usr/local/bin/minikube
</span></span></code></pre></div><h3 id="通过minikube启动集群">通过minikube启动集群<a hidden class="anchor" aria-hidden="true" href="#通过minikube启动集群">#</a></h3>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>minikube start <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>--kubernetes-version<span style="color:#666">=</span>v1.23.9 <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>--image-mirror-country<span style="color:#666">=</span><span style="color:#ba2121">&#39;cn&#39;</span> <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>--registry-mirror<span style="color:#666">=</span>https://？？？？？.mirror.aliyuncs.com
</span></span></code></pre></div><p>因为是国内，所以<code>--image-mirror-country='cn'</code>。通过<code>--registry-mirror</code>为 Docker daemon 配置镜像加速。例如上面是阿里云镜像服务地址。
因为我学习的版本是1.23.x，所以制定了版本<code>--kubernetes-version=v1.23.9</code>。
默认他读去了驱动配置，识别是<code>parallels</code>,自己定义方式<code>--driver=hyperkit</code>。</p>
<p>安装结果：
<img loading="lazy" src="https://s2.loli.net/2023/01/06/C3AFxdiPbq8aIuR.jpg" alt="C3AFxdiPbq8aIuR"  />
</p>
<p><em>错误</em>：
如果存在错误请看具体上面的问题，很多情况都能直观看到提示。其中图标是❗️提示一些问题、💡给你一些建议等等。</p>
<h4 id="驱动选择">驱动选择：<a hidden class="anchor" aria-hidden="true" href="#驱动选择">#</a></h4>
<p>使用docker驱动需要安装docker desktop。其他驱动：virtualbox、vmware、ssh、Hyperkit等。具体详见<a href="https://minikube.sigs.k8s.io/docs/drivers/">drivers page</a></p>
<h3 id="验证结果">验证结果<a hidden class="anchor" aria-hidden="true" href="#验证结果">#</a></h3>
<ul>
<li>
<p>查询minikube状态
<img loading="lazy" src="https://s2.loli.net/2023/01/06/otU8LYBjuFeDa31.png" alt="otU8LYBjuFeDa31"  />
</p>
</li>
<li>
<p>进入面板
<img loading="lazy" src="https://s2.loli.net/2023/01/06/FmrBXOTJ1N2AZgU.png" alt="FmrBXOTJ1N2AZgU"  />

<img loading="lazy" src="https://s2.loli.net/2023/01/06/IPBCwUSx7Fb28Ee.png" alt="IPBCwUSx7Fb28Ee"  />
</p>
</li>
<li>
<p>kubectl控制
<code>minikube kubectl -- get pods -A</code>
<img loading="lazy" src="https://s2.loli.net/2023/01/06/EziUHcpln27ufeB.png" alt="EziUHcpln27ufeB"  />
</p>
</li>
</ul>
<p>kubectl在minikube中使用，需要写 <code>nimikune kubectl --</code>后面加入执行的命令。
macos默认使用的zsh，在zsh加入alias就可以敲的少的了。</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-zsh" data-lang="zsh"><span style="display:flex;"><span>vi ~/.zshrc
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#加入一行</span>
</span></span><span style="display:flex;"><span><span style="color:#008000">alias</span> <span style="color:#19177c">kubectl</span><span style="color:#666">=</span><span style="color:#ba2121">&#34;minikube kubectl --&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#退出</span>
</span></span><span style="display:flex;"><span><span style="color:#008000">source</span> ~/.zshrc
</span></span></code></pre></div><ul>
<li>再创建一个Pod
创建：
<code>kubectl run nginx --image=nginx:alpine</code>
查询：
<code>kubectl get pods nginx</code>
详情：
<code>kubectl describe pods nginx</code>
<img loading="lazy" src="https://s2.loli.net/2023/01/06/pYPqIgt84LzBcEU.png" alt="pYPqIgt84LzBcEU"  />
</li>
</ul>
<p>到这里k8s可以使用了。</p>
<h1 id="ubuntu2204部署方式">Ubuntu22.04部署方式<a hidden class="anchor" aria-hidden="true" href="#ubuntu2204部署方式">#</a></h1>
<p>我在续集上安装了一个Ubuntu的操作系统。在上面安装一遍，这次驱动是docker。
装完系统后，安装docker。
<a href="https://docs.docker.com/engine/install/ubuntu/">官方手册</a></p>
<ol>
<li>准备源操作</li>
</ol>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sudo apt-get remove docker docker-engine docker.io containerd runc
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sudo apt-get update
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sudo apt-get -y install <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>ca-certificates <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>curl <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>gnupg <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>lsb-release
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>sudo mkdir -p /etc/apt/keyrings <span style="color:#666">&amp;&amp;</span> curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#008000">echo</span> <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>  <span style="color:#ba2121">&#34;deb [arch=</span><span style="color:#008000;font-weight:bold">$(</span>dpkg --print-architecture<span style="color:#008000;font-weight:bold">)</span><span style="color:#ba2121"> signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">  </span><span style="color:#008000;font-weight:bold">$(</span>lsb_release -cs<span style="color:#008000;font-weight:bold">)</span><span style="color:#ba2121"> stable&#34;</span> | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null
</span></span></code></pre></div><ol start="2">
<li>安装Docker Engine</li>
</ol>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo apt-get update
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#给当前用户加入docker组，加入完成注销再登陆</span>
</span></span><span style="display:flex;"><span>sudo usermod -aG docker <span style="color:#19177c">$USER</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"># 自启</span>
</span></span><span style="display:flex;"><span>sudo systemctl <span style="color:#008000">enable</span> docker.service
</span></span></code></pre></div><ol start="3">
<li>安装minikube</li>
</ol>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sudo install minikube-linux-amd64 /usr/local/bin/minikube
</span></span></code></pre></div><p><img loading="lazy" src="https://s2.loli.net/2023/01/06/b8ZMAqLeOviN19D.jpg" alt="b8ZMAqLeOviN19D"  />
</p>
<ol start="4">
<li>部署k8s</li>
</ol>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>minikube start <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>--kubernetes-version<span style="color:#666">=</span>v1.23.9 <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>--image-mirror-country<span style="color:#666">=</span><span style="color:#ba2121">&#39;cn&#39;</span> <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>--registry-mirror<span style="color:#666">=</span>https://????????.mirror.aliyuncs.com
</span></span></code></pre></div><p><img loading="lazy" src="https://s2.loli.net/2023/01/06/CkRH2nNBodxzh6F.jpg" alt="CkRH2nNBodxzh6F"  />
</p>
<p>可以看到装完他还提示我 kubectl没有。
5. 安装kubectl
<code>curl -LO https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl</code></p>
<p><code>sudo chmod +x kubectl &amp;&amp; sudo  mv ./kubectl /usr/local/bin/kubectl </code></p>
<p><img loading="lazy" src="https://s2.loli.net/2023/01/06/rOksbmSFMdhXipu.jpg" alt="rOksbmSFMdhXipu"  />
</p>
<p>到此再Ubuntu2204也部署完成。</p>
<p>后面继续学习</p>
<p>祝好～</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/aLong/tags/linux/">Linux</a></li>
      <li><a href="http://localhost:1313/aLong/tags/kubernetes/">Kubernetes</a></li>
    </ul>
  </footer>
</article>
    </main>
    <footer>
    // ... 其他页脚内容 ...
    <a href="http://localhost:1313/aLong/index.xml">订阅RSS</a>
</footer></body>

</html>