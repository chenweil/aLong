<!DOCTYPE html>
<html lang="en" dir=" auto">

<head><script src="/aLong/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=aLong/livereload" data-no-instant defer></script>
</head>

<body class="" id="
    top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/aLong/" accesskey="h" title="aLong blog (Alt + H)">aLong blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      数据库迁移
    </h1>
    <div class="post-meta"><span title='2019-07-26 14:30:25 +0000 UTC'>2019-07-26</span>

</div>
  </header> 
  <div class="post-content"><h2 id="laravel5-数据库迁移笔记">Laravel5 数据库迁移笔记<a hidden class="anchor" aria-hidden="true" href="#laravel5-数据库迁移笔记">#</a></h2>
<ul>
<li>
<h3 id="创建迁移文件">创建迁移文件<a hidden class="anchor" aria-hidden="true" href="#创建迁移文件">#</a></h3>
<p>命令: <code>make:migration</code></p>
<p>举例: <code>php artisan make:migration create_users_table --create=users</code></p>
<p>生成位置: 项目/database/migrations/下 文件名已时间开头,后面是自己创建迁移文件名字.</p>
<p>&ndash;creat 指定数据库中表的名字</p>
</li>
<li>
<h3 id="编辑迁移文件">编辑迁移文件<a hidden class="anchor" aria-hidden="true" href="#编辑迁移文件">#</a></h3>
<p>打开迁移文件:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000;font-weight:bold">use</span> Illuminate\Support\Facades\Schema;
</span></span><span style="display:flex;"><span>   <span style="color:#008000;font-weight:bold">use</span> Illuminate\Database\Schema\Blueprint;
</span></span><span style="display:flex;"><span>   <span style="color:#008000;font-weight:bold">use</span> Illuminate\Database\Migrations\Migration;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000;font-weight:bold">class</span> <span style="color:#00f;font-weight:bold">CreateUsersTable</span> <span style="color:#008000;font-weight:bold">extends</span> Migration
</span></span><span style="display:flex;"><span>   {
</span></span><span style="display:flex;"><span>       <span style="color:#ba2121;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121;font-style:italic">        * Run the migrations.
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121;font-style:italic">        *
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121;font-style:italic">        * @return void
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121;font-style:italic">        */</span>
</span></span><span style="display:flex;"><span>       <span style="color:#008000;font-weight:bold">public</span> <span style="color:#008000;font-weight:bold">function</span> <span style="color:#00f">up</span>()
</span></span><span style="display:flex;"><span>       {
</span></span><span style="display:flex;"><span>           Schema<span style="color:#666">::</span><span style="color:#7d9029">create</span>(<span style="color:#ba2121">&#39;users&#39;</span>, <span style="color:#008000;font-weight:bold">function</span> (Blueprint <span style="color:#19177c">$table</span>) {
</span></span><span style="display:flex;"><span>               <span style="color:#19177c">$table</span><span style="color:#666">-&gt;</span><span style="color:#7d9029">bigIncrements</span>(<span style="color:#ba2121">&#39;id&#39;</span>);
</span></span><span style="display:flex;"><span>               <span style="color:#19177c">$table</span><span style="color:#666">-&gt;</span><span style="color:#7d9029">string</span>(<span style="color:#ba2121">&#39;name&#39;</span>);
</span></span><span style="display:flex;"><span>               <span style="color:#19177c">$table</span><span style="color:#666">-&gt;</span><span style="color:#7d9029">string</span>(<span style="color:#ba2121">&#39;email&#39;</span>)<span style="color:#666">-&gt;</span><span style="color:#7d9029">unique</span>();
</span></span><span style="display:flex;"><span>               <span style="color:#19177c">$table</span><span style="color:#666">-&gt;</span><span style="color:#7d9029">timestamp</span>(<span style="color:#ba2121">&#39;email_verified_at&#39;</span>)<span style="color:#666">-&gt;</span><span style="color:#7d9029">nullable</span>();
</span></span><span style="display:flex;"><span>               <span style="color:#19177c">$table</span><span style="color:#666">-&gt;</span><span style="color:#7d9029">string</span>(<span style="color:#ba2121">&#39;password&#39;</span>);
</span></span><span style="display:flex;"><span>               <span style="color:#19177c">$table</span><span style="color:#666">-&gt;</span><span style="color:#7d9029">rememberToken</span>();
</span></span><span style="display:flex;"><span>               <span style="color:#19177c">$table</span><span style="color:#666">-&gt;</span><span style="color:#7d9029">timestamps</span>();
</span></span><span style="display:flex;"><span>           });
</span></span><span style="display:flex;"><span>       }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       <span style="color:#ba2121;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121;font-style:italic">        * Reverse the migrations.
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121;font-style:italic">        *
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121;font-style:italic">        * @return void
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121;font-style:italic">        */</span>
</span></span><span style="display:flex;"><span>       <span style="color:#008000;font-weight:bold">public</span> <span style="color:#008000;font-weight:bold">function</span> <span style="color:#00f">down</span>()
</span></span><span style="display:flex;"><span>       {
</span></span><span style="display:flex;"><span>           Schema<span style="color:#666">::</span><span style="color:#7d9029">dropIfExists</span>(<span style="color:#ba2121">&#39;users&#39;</span>);
</span></span><span style="display:flex;"><span>       }
</span></span><span style="display:flex;"><span>   }
</span></span></code></pre></div></li>
</ul>
<pre tabindex="0"><code>文件中有两个方法,up/down . 可以理解为创建执行时up方法,rollback时候是执行down方法.

up方法中:
    创建了7个字段,表明为 users.
    
    创建字段操作 `$table-&gt;` 后面加上字段类型 `string` ,指定字段名称`(&#39;name&#39;)` 字段被指 `-&gt;comment(&#39;名子&#39;)`; 
    
    具体每个字段类型,以及其他属性定义,请查询手册.
    


* ### 执行迁移文件

  这个迁移文件是创建表,所以down是删除表.也就是当我们执行 `php artisan migrate:rollback` 回滚到上一步就是把这表删除(前提创建之后).

  执行命令: `php artisan migrate` 执行迁移文件创建表单.
  
  如果我们后悔创建:可以执行回滚. `php artisan migrate:rollback `  --step 指定回滚次数 `php artisan migrate:rollback --step=2` 执行回滚迁移2次钱.
  
  `php artisan migrate:reset` 回滚所有迁移
  
  `php artisan migrate:fresh` 删除所有回滚
  
  
* ### 为前迁移文件修改字段,改名.
当我们上面的文件执行后,需要增加一个字段,那么就需要新建一个迁移文件.不要直接操作数据库.

    `php artisan make:migration add_id_to_users_table --table=users` 
    
    这里为users表新增身份证字段.
    
    打开文件 新建身份证id列. 
    
    之后我们执行迁移文件.成功后就能看到新得ID字段已经出现.对于编辑和修改都可以.

    `$table-&gt;renameColumn(&#39;ID&#39;, &#39;id&#39;)` 改名id
    
    对应dorop 也需要dropColumn 此字段.
    
    最后执行此迁移文件.


    
</code></pre>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/aLong/tags/laravel/">Laravel</a></li>
    </ul>
  </footer>
</article>
    </main>
    <footer>
    // ... 其他页脚内容 ...
    <a href="http://localhost:1313/aLong/index.xml">订阅RSS</a>
</footer></body>

</html>