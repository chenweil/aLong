<!doctype html><html lang=en><head><script src="/aLong/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=aLong/livereload" data-no-instant defer></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>Prometheus-SNMP_Exporter Generator</title>
<meta name=description content="Prometheus-SNMP Exporter 生成器从generator.yml读取并写入snmp.yml。
之前在说Prometheus-snmp_export部署时,没有具体提到snmp.yml的生成器是怎么生成的.几乎用的都是github上的snmp.yml文件(只在demo中添加了auth配置).
因为刚好 …"><meta name=keywords content='blog,aLong,blog.51ai.vip,SNMP,Prometheus'><meta property="og:url" content="http://localhost:1313/aLong/prometheus-snmp-exporter-generator/"><meta property="og:type" content="website"><meta property="og:title" content="Prometheus-SNMP_Exporter Generator"><meta property="og:description" content="Prometheus-SNMP Exporter 生成器从generator.yml读取并写入snmp.yml。
之前在说Prometheus-snmp_export部署时,没有具体提到snmp.yml的生成器是怎么生成的.几乎用的都是github上的snmp.yml文件(只在demo中添加了auth配置).
因为刚好 …"><meta property="og:image" content="http://localhost:1313/aLong/"><meta property="og:image:secure_url" content="http://localhost:1313/aLong/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Prometheus-SNMP_Exporter Generator"><meta name=twitter:description content="Prometheus-SNMP Exporter 生成器从generator.yml读取并写入snmp.yml。
之前在说Prometheus-snmp_export部署时,没有具体提到snmp.yml的生成器是怎么生成的.几乎用的都是github上的snmp.yml文件(只在demo中添加了auth配置).
因为刚好 …"><meta property="twitter:domain" content="http://localhost:1313/aLong/prometheus-snmp-exporter-generator/"><meta property="twitter:url" content="http://localhost:1313/aLong/prometheus-snmp-exporter-generator/"><meta name=twitter:image content="http://localhost:1313/aLong/"><link rel=canonical href=http://localhost:1313/aLong/prometheus-snmp-exporter-generator/><link rel=stylesheet type=text/css href=/aLong/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/aLong/css/main.min.css><link id=dark-theme rel=stylesheet href=/aLong/css/dark.min.css><script src=/aLong/js/bundle.min.9a920d7dabdbad8363b6a0a94e29a9dfebdb7ee64cfcb193a0145e512ef2bdab.js integrity="sha256-mpINfavbrYNjtqCpTimp3+vbfuZM/LGToBReUS7yvas="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=nav-title><a class=nav-brand href=http://localhost:1313/aLong/>aLong Blog</a></div><div class=nav-links><div class=nav-link><a href=http://localhost:1313/aLong/><span data-feather=home></span> Home</a></div><div class=nav-link><a href=http://localhost:1313/aLong/posts/>Posts</a></div><div class=nav-link><a href=http://localhost:1313/aLong/tags/>Tags</a></div><div class=nav-link><a href=http://localhost:1313/aLong/index.xml><span data-feather=rss></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target"></span>
<a><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=http://localhost:1313/aLong/><span data-feather=home></span> Home</a></li><li class=nav-item><a href=http://localhost:1313/aLong/posts/>Posts</a></li><li class=nav-item><a href=http://localhost:1313/aLong/tags/>Tags</a></li><li class=nav-item><a href=http://localhost:1313/aLong/index.xml><span data-feather=rss></span></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>Prometheus-SNMP_Exporter Generator</h1></div><div class=post-content><h2 id=prometheus-snmp-exporter>Prometheus-SNMP Exporter</h2><blockquote><p>生成器从generator.yml读取并写入snmp.yml。</p></blockquote><p>之前在说<a href=https://blog.51ai.vip/2019/08/29/Prometheus-snmp-export%E9%83%A8%E7%BD%B2/>Prometheus-snmp_export部署</a>时,没有具体提到snmp.yml的生成器是怎么生成的.几乎用的都是github上的<a href=https://github.com/prometheus/snmp_exporter/blob/master/snmp.yml>snmp.yml</a>文件(只在demo中添加了auth配置).</p><p>因为刚好所有通用的指标都取得通用的mib树. 在后期我搜集设备的信息需要一些私有mib的数据,这时候需要自己通过生成器来生成snmp.yml.</p><h2 id=generator-的操作步骤>Generator 的操作步骤</h2><h3 id=下载需要的程序docker方式跳过此步骤>下载需要的程序(Docker方式跳过此步骤)</h3><pre tabindex=0><code># Debian-based distributions.
sudo apt-get install unzip build-essential libsnmp-dev # Debian-based distros
# Redhat-based distributions.
sudo yum install gcc gcc-g++ make net-snmp net-snmp-utils net-snmp-libs net-snmp-devel # RHEL-based distros

go get github.com/prometheus/snmp_exporter/generator
cd ${GOPATH-$HOME/go}/src/github.com/prometheus/snmp_exporter/generator
go build
make mibs(不建议直接make)
</code></pre><p>这里直接make mibs 可能会失败,在make文件里设置的源有些已经不能访问了或执行出现错误.</p><p>我建议先下载好mibs ,我已经上传<a href=https://github.com/chenweil/mibs>github</a>.</p><p><em><strong>建议自行搜集mib 不执行make mibs会方便一些</strong></em></p><p>把所有的mib放入mibs 目录下.</p><p>需要准备好所有需要涉及到的mib文件. 除了公有的mib,我们还需要监控目标设备的私有mib.思科/华为之类的会提供这些mib,像锐捷这种需要和商务部联系.</p><hr><p><em>一些mib:</em></p><p><a href=https://github.com/netdisco/netdisco-mibs>https://github.com/netdisco/netdisco-mibs</a></p><p><a href=https://github.com/pgmillon/observium/tree/master/mibs>https://github.com/pgmillon/observium/tree/master/mibs</a></p><p><a href=https://github.com/librenms/librenms/tree/master/mibs>https://github.com/librenms/librenms/tree/master/mibs</a></p><hr><h3 id=当我们准备好所有的mib后需要编写一个generatoryml>当我们准备好所有的mib后,需要编写一个generator.yml.</h3><p><code>下面是一个翻译的官方文档(翻译比较烂,自行查阅[原文]([https://github.com/prometheus/snmp\_exporter/tree/master/generator](https://github.com/prometheus/snmp\_exporter/tree/master/generator))):</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>modules</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>module_name</span>:  <span style=color:#75715e># 模块名称。您可以根据需要拥有任意数量的模块。</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>walk</span>:       <span style=color:#75715e># 要walk的OID列表。 也可以是SNMP对象名称或特定实例。</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>1.3.6.1.2.1.2</span>              <span style=color:#75715e># 与“接口”相同。</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>sysUpTime                 </span> <span style=color:#75715e># 与“ 1.3.6.1.2.1.1.3”相同。</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>1.3.6.1.2.1.31.1.1.1.6.40</span>  <span style=color:#75715e># 索引为“ 40”的“ ifHCInOctets”的实例。</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>version</span>: <span style=color:#ae81ff>2</span>  <span style=color:#75715e># 要使用的SNMP版本。 默认2。</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e># 1将使用GETNEXT，2和3将使用GETBULK。</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>max_repetitions</span>: <span style=color:#ae81ff>25</span>  <span style=color:#75715e># 使用GET / GETBULK请求多少个对象，默认为25。</span>
</span></span><span style=display:flex><span>                         <span style=color:#75715e># 对于有故障的设备，可能需要减少。</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>retries</span>: <span style=color:#ae81ff>3</span>   <span style=color:#75715e># 重试失败请求的次数，默认为3。</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>timeout</span>: <span style=color:#ae81ff>10s</span> <span style=color:#75715e># 每次步行的超时时间，默认为10秒。</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>auth</span>:
</span></span><span style=display:flex><span>      <span style=color:#75715e># 社区字符串与SNMP v1和v2一起使用。 默认为“ public”。</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>community</span>: <span style=color:#ae81ff>public</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># v3具有不同且更复杂的设置。</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># 需要哪些取决于security_level。</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># 还列出了NetSNMP命令上的等效选项，例如snmpbulkwalk和snmpget。</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># 请参见snmpcmd（1）。</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>username</span>: <span style=color:#ae81ff>user </span> <span style=color:#75715e># 必需，无默认值。 NetSNMP的-u选项。</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>security_level</span>: <span style=color:#ae81ff>noAuthNoPriv </span> <span style=color:#75715e># 默认为noAuthNoPriv。 NetSNMP的-l选项。</span>
</span></span><span style=display:flex><span>                                    <span style=color:#75715e># 可以是noAuthNoPriv，authNoPriv或authPriv。</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>password</span>: <span style=color:#ae81ff>pass </span> <span style=color:#75715e># 没有默认值。 也称为authKey，NetSNMP的-A选项。</span>
</span></span><span style=display:flex><span>                      <span style=color:#75715e># 如果security_level是authNoPriv或authPriv，则为必需。</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>auth_protocol</span>: <span style=color:#ae81ff>MD5 </span> <span style=color:#75715e># MD5或SHA，默认为MD5。 -NetSNMP的选项。</span>
</span></span><span style=display:flex><span>                          <span style=color:#75715e># 如果security_level为authNoPriv或authPriv，则使用此属性。</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>priv_protocol</span>: <span style=color:#ae81ff>DES </span> <span style=color:#75715e># DES或AES，默认为DES。 NetSNMP的-x选项。</span>
</span></span><span style=display:flex><span>                          <span style=color:#75715e># 如果security_level为authPriv，则使用。</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>priv_password</span>: <span style=color:#ae81ff>otherPass</span> <span style=color:#75715e># 没有默认值。 也称为privKey，NetSNMP的-X选项。</span>
</span></span><span style=display:flex><span>                               <span style=color:#75715e># 如果security_level是authPriv，则为必需。</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>context_name</span>: <span style=color:#ae81ff>context</span> <span style=color:#75715e># 没有默认值。 NetSNMP的-n选项。</span>
</span></span><span style=display:flex><span>                            <span style=color:#75715e># 如果在设备上配置了上下文，则为必需。</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>lookups</span>:  <span style=color:#75715e># 要执行的查找的可选列表。</span>
</span></span><span style=display:flex><span>              <span style=color:#75715e># “keep_source_indexes”的默认值为false。 </span>
</span></span><span style=display:flex><span>              <span style=color:#75715e># 索引必须唯一，才能使用此选项。</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># 如果表的索引是bsnDot11EssIndex，则通常是该表结果度量的标签。</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># 相反,使用索引查找bsnDot11EssSsid表条目，并使用该值创建一个bsnDot11EssSsid标签。</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>source_indexes</span>: [<span style=color:#ae81ff>bsnDot11EssIndex]</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>lookup</span>: <span style=color:#ae81ff>bsnDot11EssSsid</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>drop_source_indexes</span>: <span style=color:#66d9ef>false</span>  <span style=color:#75715e># 如果为true，则删除此查找的源索引标签。</span>
</span></span><span style=display:flex><span>                                    <span style=color:#75715e># 当新索引唯一时，这可以避免标签混乱。</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>overrides</span>: <span style=color:#75715e># 允许每个模块覆盖MIB的位</span>
</span></span><span style=display:flex><span>       <span style=color:#f92672>metricName</span>:
</span></span><span style=display:flex><span>         <span style=color:#f92672>ignore</span>: <span style=color:#66d9ef>true</span> <span style=color:#75715e># 从输出中删除度量。</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>regex_extracts</span>:
</span></span><span style=display:flex><span>           <span style=color:#f92672>Temp</span>: <span style=color:#75715e># 将创建一个新的度量，并将其附加到metricName上，成为metricNameTemp。</span>
</span></span><span style=display:flex><span>             - <span style=color:#f92672>regex</span>: <span style=color:#e6db74>&#39;(.*)&#39;</span> <span style=color:#75715e># 正则表达式从返回的SNMP walk的值中提取一个值。</span>
</span></span><span style=display:flex><span>               <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#39;$1&#39;</span> <span style=color:#75715e># 结果将解析为float64，默认为$1。</span>
</span></span><span style=display:flex><span>           <span style=color:#f92672>Status</span>:
</span></span><span style=display:flex><span>             - <span style=color:#f92672>regex</span>: <span style=color:#e6db74>&#39;.*Example&#39;</span>
</span></span><span style=display:flex><span>               <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#39;1&#39;</span>
</span></span><span style=display:flex><span>             - <span style=color:#f92672>regex</span>: <span style=color:#e6db74>&#39;.*&#39;</span>
</span></span><span style=display:flex><span>               <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#39;0&#39;</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>type</span>: <span style=color:#ae81ff>DisplayString</span> <span style=color:#75715e># 覆盖度量标准类型，可能的类型有：</span>
</span></span><span style=display:flex><span>                             <span style=color:#75715e>#   gauge:   带gauge的整数。</span>
</span></span><span style=display:flex><span>                             <span style=color:#75715e>#   counter: 带类型计数器的整数。</span>
</span></span><span style=display:flex><span>                             <span style=color:#75715e>#   OctetString: 一个位字符串，呈现为0xff34。</span>
</span></span><span style=display:flex><span>                             <span style=color:#75715e>#   DateAndTime: RFC 2579日期和时间字节序列。如果设备没有时区数据，则使用UTC。</span>
</span></span><span style=display:flex><span>                             <span style=color:#75715e>#   DisplayString: ASCII或UTF-8字符串。</span>
</span></span><span style=display:flex><span>                             <span style=color:#75715e>#   PhysAddress48: 一个48位的MAC地址，呈现为00:01:02:03:04:ff。</span>
</span></span><span style=display:flex><span>                             <span style=color:#75715e>#   Float: 一个32位浮点值，带有类型gauge。</span>
</span></span><span style=display:flex><span>                             <span style=color:#75715e>#   Double: 一个64位浮点值，带有类型gauge。</span>
</span></span><span style=display:flex><span>                             <span style=color:#75715e>#   InetAddressIPv4: IPv4地址，呈现为1.2.3.4。</span>
</span></span><span style=display:flex><span>                             <span style=color:#75715e>#   InetAddressIPv6: IPv6地址，呈现为0102:0304:0506:0708:090A:0B0C:0D0E:0F10。</span>
</span></span><span style=display:flex><span>                             <span style=color:#75715e>#   InetAddress: 每个RFC 4001有一个InetAddress。必须以InetAddressType开头。</span>
</span></span><span style=display:flex><span>                             <span style=color:#75715e>#   InetAddressMissingSize: 因索引中没有大小而违反RFC 4001第4.1节的InetAddress。</span>
</span></span><span style=display:flex><span>                             <span style=color:#75715e>#                           必须以InetAddressType开头。</span>
</span></span><span style=display:flex><span>                             <span style=color:#75715e>#   EnumAsInfo: 为其创建单个时间序列的枚举。适用于恒定值。</span>
</span></span><span style=display:flex><span>                             <span style=color:#75715e>#   EnumAsStateSet: 每个状态具有时间序列的枚举。适用于可变低基数枚举。</span>
</span></span><span style=display:flex><span>                             <span style=color:#75715e>#   Bits: 一种RFC2578位结构，它产生一个具有每位时间序列的状态集。</span>
</span></span></code></pre></div><p>下面提供一个自己编写的generator.yml</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>modules</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ruijie_mib</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>walk</span>: 
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>interfaces</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>ifXTable</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>sysUpTime</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>sysName</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>myMemoryPoolCurrentUtilization</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>myCPUUtilization5Sec</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>timeout</span>: <span style=color:#ae81ff>12s</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>version</span>: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>auth</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>community</span>: <span style=color:#ae81ff>Monitor@#@Jkj</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>lookups</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>source_indexes</span>: [<span style=color:#ae81ff>ifIndex]</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>lookup</span>: <span style=color:#ae81ff>ifAlias</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>source_indexes</span>: [<span style=color:#ae81ff>ifIndex]</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>lookup</span>: <span style=color:#ae81ff>ifDescr</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>source_indexes</span>: [<span style=color:#ae81ff>ifIndex]</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>lookup</span>: <span style=color:#ae81ff>1.3.6.1.2.1.31.1.1.1.1</span> 
</span></span><span style=display:flex><span>    <span style=color:#f92672>overrides</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>ifAlias</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ignore</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>ifDescr</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ignore</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>ifName</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ignore</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>ifType</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>type</span>: <span style=color:#ae81ff>EnumAsInfo</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>sysDescr</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>type</span>: <span style=color:#ae81ff>DisplayString</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>sysLocation</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>type</span>: <span style=color:#ae81ff>DisplayString</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>ifPhysAddress</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>type</span>: <span style=color:#ae81ff>PhysAddress48</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>sysName</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>type</span>: <span style=color:#ae81ff>DisplayString</span>
</span></span></code></pre></div><p>解释一下此配置的目的:</p><ul><li><p>模块名称 ruijie_mib 通过名字可以知道是作用锐捷设备</p></li><li><p>walk 中, 是需要获取的指标. 其中前四个是共有mib获取到的,后面是私有mib获取到的.</p></li><li><p>timeout 超时定义12秒</p></li><li><p>version snmp协议是v2</p></li><li><p>auth 定义的团体名</p></li><li><p>looksups 通过索引查找列表</p></li><li><p>overrides 前三个指标删除,后面几项是定义了他们的数据类型.</p></li></ul><h3 id=万事具备只差执行>万事具备,只差执行.</h3><p>准备工作完成之后,就可以执行程序了.</p><h4 id=bin执行>bin执行</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export MIBDIRS<span style=color:#f92672>=</span>mibs
</span></span><span style=display:flex><span>./generator generate
</span></span></code></pre></div><p>执行后,可以看到snmp.yml.</p><h4 id=docker方式>Docker方式</h4><p>通过dicker方式时，除上面需要的 <strong>mibs</strong> 文件夹和 <strong>generate.yml</strong> 再生成一个容器就好了。</p><p>pull镜像</p><p><code>docker pull prom/snmp-exporter:latest</code> (查看具体版本)[https://hub.docker.com/r/prom/snmp-exporter/tags]</p><p>镜像通过挂在宿主机文件后，通过generate.yml生成snmp.yml</p><p>目录结构：</p><pre tabindex=0><code>   ./generate.yml
   ./mibs
</code></pre><p>执行生成snmp.yml</p><p><code>docker run -ti -v "${PWD}:/opt/" prom/snmp-generator generate</code></p><p>此容器挂载了一个目录，此目录下包含之前准备的 <strong>mibs</strong> 文件夹和 <strong>generate.yml</strong>。</p><p>执行完毕会在目录中生成 snmp.yml 文件。</p><p>出现错误排查：</p><p><em>generate</em> 命令改成 <em>parse_errors</em></p><p>通常这样使用：</p><p><code>docker run -ti -v "${PWD}:/opt/" snmp-generator parse_errors | head</code></p><h3 id=生成出现问题两个方向>生成出现问题两个方向：</h3><ol><li>generate.yml 编写存在错误，格式 或者 指令。 可参考官方提供**<a href=https://github.com/prometheus/snmp_exporter/tree/master/generator/generator.yml>模版</a>**测试。</li><li>mib文件准备不足，缺少mib文件。可通过官方介绍提供的**<a href=https://github.com/prometheus/snmp_exporter/tree/master/generator#where-to-get-mibs>地址</a><strong>。我在</strong><a href=https://github.com/chenweil/mibs>github</a>**上分享了自己收集一些mib文件</li></ol></div><svg id="btt-button" class="arrow-logo" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div></main><footer class=footer><span>&copy; 2019 aLong</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/526avijitgupta/gokarna>Gokarna</a></span></footer></body></html>